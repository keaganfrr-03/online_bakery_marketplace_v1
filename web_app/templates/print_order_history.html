{% extends "base_sidebar.html" %}
{% block title %}My Order History{% endblock %}

{% block content %}
<h2 class="mb-4">My Order History</h2>

<!-- Buttons Row (hidden when printing) -->
<div class="d-flex justify-content-end mb-3 no-print">
    <!-- Print Button -->
    <button onclick="window.print()" class="btn btn-outline-secondary btn-sm me-2">
        <i class="bi bi-printer"></i> Print
    </button>
    <!-- Download PDF -->
    <a href="{% url 'download_customer_order_history' %}" class="btn btn-outline-primary btn-sm">
        <i class="bi bi-download"></i> Download
    </a>
</div>

{# ✅ Completed Orders #}
<h4 class="mt-4">✅ Completed Orders</h4>
{% if completed_orders %}
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Order #</th>
                <th>Date</th>
                <th>Total</th>
                <th>Delivery Address</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for order in completed_orders %}
                <tr>
                    <td>{{ order.id }}</td>
                    <td>{{ order.created_at|date:"Y-m-d H:i" }}</td>
                    <td>R{{ order.total_price }}</td>
                    <td>{{ order.delivery_address }}</td>
                    <td><span class="badge bg-success">Paid</span></td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <p class="text-muted">No completed orders.</p>
{% endif %}

{# ❌ Cancelled Orders #}
<h4 class="mt-4">❌ Cancelled Orders</h4>
{% if cancelled_orders %}
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Order #</th>
                <th>Date</th>
                <th>Total</th>
                <th>Delivery Address</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for order in cancelled_orders %}
                <tr>
                    <td>{{ order.id }}</td>
                    <td>{{ order.created_at|date:"Y-m-d H:i" }}</td>
                    <td>R{{ order.total_price }}</td>
                    <td>{{ order.delivery_address }}</td>
                    <td><span class="badge bg-danger">Cancelled</span></td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <p class="text-muted">No cancelled orders.</p>
{% endif %}

<!-- Print-only CSS -->
<style>
@media print {
    .no-print {
        display: none !important;
    }
}
</style>

{% endblock %}
